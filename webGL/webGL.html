<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>刷底色 | 微服务部署学习</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="微服务部署学习">
    
    <link rel="preload" href="/m_microservices/assets/css/0.styles.40b1a2a3.css" as="style"><link rel="preload" href="/m_microservices/assets/js/app.acc81fd3.js" as="script"><link rel="preload" href="/m_microservices/assets/js/2.5d075586.js" as="script"><link rel="preload" href="/m_microservices/assets/js/17.b6232007.js" as="script"><link rel="prefetch" href="/m_microservices/assets/js/10.81525143.js"><link rel="prefetch" href="/m_microservices/assets/js/11.3d92c7b4.js"><link rel="prefetch" href="/m_microservices/assets/js/12.168b256c.js"><link rel="prefetch" href="/m_microservices/assets/js/13.6f984ad9.js"><link rel="prefetch" href="/m_microservices/assets/js/14.f230cc96.js"><link rel="prefetch" href="/m_microservices/assets/js/15.68d27749.js"><link rel="prefetch" href="/m_microservices/assets/js/16.dfe7e6d6.js"><link rel="prefetch" href="/m_microservices/assets/js/3.a9c84adc.js"><link rel="prefetch" href="/m_microservices/assets/js/4.80a1182c.js"><link rel="prefetch" href="/m_microservices/assets/js/5.9910cc1b.js"><link rel="prefetch" href="/m_microservices/assets/js/6.c38b2f04.js"><link rel="prefetch" href="/m_microservices/assets/js/7.bcbe6134.js"><link rel="prefetch" href="/m_microservices/assets/js/8.98adcd31.js"><link rel="prefetch" href="/m_microservices/assets/js/9.fe947486.js">
    <link rel="stylesheet" href="/m_microservices/assets/css/0.styles.40b1a2a3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/m_microservices/" class="home-link router-link-active"><!----> <span class="site-name">微服务部署学习</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/m_microservices/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博客" class="dropdown-title"><span class="title">博客</span> <span class="arrow down"></span></button> <button type="button" aria-label="博客" class="mobile-dropdown-title"><span class="title">博客</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/mqyqingfeng" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/712139234359182/posts" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/m_microservices/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博客" class="dropdown-title"><span class="title">博客</span> <span class="arrow down"></span></button> <button type="button" aria-label="博客" class="mobile-dropdown-title"><span class="title">博客</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/mqyqingfeng" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/712139234359182/posts" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/m_microservices/linuxbase/linuxbase.html" class="sidebar-heading clickable"><span>linux基础</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/m_microservices/linuxbase/linuxbase.html" class="sidebar-link">常用命令</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/m_microservices/dockerbase/dockerbase.html" class="sidebar-heading clickable"><span>docker基础</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/m_microservices/dockerbase/dockerbase.html" class="sidebar-link">docker命令</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/m_microservices/nginxbase/nginxbase.html" class="sidebar-heading clickable"><span>nginx基础</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/m_microservices/nginxbase/nginxbase.html" class="sidebar-link">nginx基础</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/m_microservices/nomadbase/nomadbase.html" class="sidebar-heading clickable"><span>Nomad基础</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/m_microservices/nomad/nomadbase.html" class="sidebar-link">nomad基础</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/m_microservices/consul/consulbase.html" class="sidebar-heading clickable"><span>Consul基础</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/m_microservices/consul/consulbase.html" class="sidebar-link">consul基础</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/m_microservices/kong/kongbase.html" class="sidebar-heading clickable"><span>Kong基础</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/m_microservices/kong/kongbase.html" class="sidebar-link">kong基础</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/m_microservices/konga/kongabase.html" class="sidebar-heading clickable"><span>Konga基础</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/m_microservices/konga/kongabase.html" class="sidebar-link">konga基础</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/m_microservices/webGL/webGL.html" aria-current="page" class="sidebar-heading clickable router-link-exact-active router-link-active open active"><span>WebGL基础</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/m_microservices/webGL/webGL.html" aria-current="page" class="active sidebar-link">webGL基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/m_microservices/webGL/webGL.html#刷底色" class="sidebar-link">刷底色</a></li><li class="sidebar-sub-header"><a href="/m_microservices/webGL/webGL.html#webgl坐标系" class="sidebar-link">webgl坐标系</a></li><li class="sidebar-sub-header"><a href="/m_microservices/webGL/webGL.html#webgl绘图思路" class="sidebar-link">webgl绘图思路</a></li><li class="sidebar-sub-header"><a href="/m_microservices/webGL/webGL.html#webgl着色器" class="sidebar-link">webgl着色器</a></li><li class="sidebar-sub-header"><a href="/m_microservices/webGL/webGL.html#用js控制一个点的位置" class="sidebar-link">用js控制一个点的位置</a></li><li class="sidebar-sub-header"><a href="/m_microservices/webGL/webGL.html#理解同步绘图原理" class="sidebar-link">理解同步绘图原理</a></li><li class="sidebar-sub-header"><a href="/m_microservices/webGL/webGL.html#鼠标绘制多点" class="sidebar-link">鼠标绘制多点</a></li><li class="sidebar-sub-header"><a href="/m_microservices/webGL/webGL.html#改变顶点尺寸" class="sidebar-link">改变顶点尺寸</a></li><li class="sidebar-sub-header"><a href="/m_microservices/webGL/webGL.html#控制顶点颜色" class="sidebar-link">控制顶点颜色</a></li><li class="sidebar-sub-header"><a href="/m_microservices/webGL/webGL.html#uniform4fv-方法" class="sidebar-link">uniform4fv()方法</a></li><li class="sidebar-sub-header"><a href="/m_microservices/webGL/webGL.html#绘制一个圆形的顶点" class="sidebar-link">绘制一个圆形的顶点</a></li><li class="sidebar-sub-header"><a href="/m_microservices/webGL/webGL.html#绘制随机透明度的点" class="sidebar-link">绘制随机透明度的点</a></li><li class="sidebar-sub-header"><a href="/m_microservices/webGL/webGL.html#星星眨眼睛-其实就是给定几个关键帧-然后根据时间变化让透明度线性变化" class="sidebar-link">星星眨眼睛 其实就是给定几个关键帧，然后根据时间变化让透明度线性变化</a></li></ul></li><li><a href="/m_microservices/webGL/graph.html" class="sidebar-link">绘制图形</a></li><li><a href="/m_microservices/webGL/matrixTransform.html" class="sidebar-link">矩阵变换</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="刷底色"><a href="#刷底色" class="header-anchor">#</a> 刷底色</h2> <p>步骤：</p> <p>1.建立canvas画布</p> <p><code>&lt;canvas id=&quot;canvas&quot;&gt;&lt;/canvas&gt;</code></p> <p>2.获取画布元素 (纸张)</p> <p><code>const canvas = document.getElementById('canvas')</code></p> <p>3.获取webgl上下文对象（笔）</p> <p><code>const gl = canvas.getContext('webgl')</code></p> <p>4.获取将要刷的颜色（准备颜料）</p> <p><code>gl.clearColor(0,0,0,1)</code><br> <strong>这个颜色的范围是0-1，不是css的颜色值</strong></p> <p>转换成css颜色值：</p> <div class="language-# extra-class"><pre class="language-text"><code>        let str = 'rgba(203,203,2,1)'
        let reg = /\((.*)\)/g
        let rgbastr = reg.exec(str)[1]
        const rgba = rgbastr.split(&quot;,&quot;).map((item) =&gt; parseInt(item))
        const r = rgba[0] / 255
        const g = rgba[1] / 255
        const b = rgba[2] / 255
        const a = rgba[3]

        gl.clearColor(r,g,b,a)
</code></pre></div><p>5.上色</p> <p><code>gl.clear(gl.COLOR_BUFFER_BIT)</code></p> <p>6.色相偏移动画</p> <div class="language-# extra-class"><pre class="language-text"><code>!(function ani(){
    color.offsetHSL(0.005, 0, 0);
    gl.clearColor(color.r, color.g, color.b, 1);
    gl.clear(gl.COLOR_BUFFER_BIT);
    requestAnimationFrame(ani);
  })()
</code></pre></div><h2 id="webgl坐标系"><a href="#webgl坐标系" class="header-anchor">#</a> webgl坐标系</h2> <p>canvas 2d 画布和webgl 画布使用的坐标系都是二维直角坐标系，只不过它们坐标原点、y 轴的坐标方向，坐标基底都不一样了</p> <p>webgl坐标基底中的两个分量分别是半个canvas的宽和canvas的高，即1个单位的宽便是半个个canvas的宽，1个单位的高便是半个canvas的高。</p> <img src="/images/webgl1.png" width="400"> <h2 id="webgl绘图思路"><a href="#webgl绘图思路" class="header-anchor">#</a> webgl绘图思路</h2> <p>1。在html中建立canvas画布</p> <p>2。获取canvas对象</p> <p>3。canvas获取webgl上下文对象</p> <p>4。获取顶点着色起和片元着色器</p> <p>5。在js中获取顶点着色器和片元着色器</p> <img src="/images/review01.png" width="300"> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span>

canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth
canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight
<span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'webgl'</span><span class="token punctuation">)</span>
</code></pre></div><p>要先把canvas撑开再获取webgl上下文，否则高度就会有问题，要先把画布准备好才能画画</p> <h2 id="webgl着色器"><a href="#webgl着色器" class="header-anchor">#</a> webgl着色器</h2> <p><strong>顶点着色器： 描述顶点的特征，如位置，颜色等</strong></p> <p><strong>片源着色器： 进行逐片元处理，如光照</strong></p> <h2 id="用js控制一个点的位置"><a href="#用js控制一个点的位置" class="header-anchor">#</a> 用js控制一个点的位置</h2> <p>写死的点位
<code>gl_Position=vec4(-0.5,0.5,0.6,1);</code></p> <h3 id="attribute-变量"><a href="#attribute-变量" class="header-anchor">#</a> attribute 变量</h3> <p><strong>向顶点传递数据</strong></p> <p>attribute 是存储限定符，专门用于向外部到处与点位相关对象的，有点像es6中的export</p> <ul><li>在顶点着色器中声明attribute变量</li> <li>在js中获取变量</li> <li>修改attibute变量</li></ul> <h3 id="vertexattrib3f-的同族函数"><a href="#vertexattrib3f-的同族函数" class="header-anchor">#</a> vertexAttrib3f()的同族函数</h3> <p>gl.vertexAttrib3f(location,v0,v1,v2) 方法是一系列修改着色器中的attribute 变量的方法之一，它还有许多同族方法，如：</p> <div class="language-js extra-class"><pre class="language-js"><code>gl<span class="token punctuation">.</span><span class="token function">vertexAttrib1f</span><span class="token punctuation">(</span>location<span class="token punctuation">,</span>v0<span class="token punctuation">)</span> 
gl<span class="token punctuation">.</span><span class="token function">vertexAttrib2f</span><span class="token punctuation">(</span>location<span class="token punctuation">,</span>v0<span class="token punctuation">,</span>v1<span class="token punctuation">)</span>
gl<span class="token punctuation">.</span><span class="token function">vertexAttrib3f</span><span class="token punctuation">(</span>location<span class="token punctuation">,</span>v0<span class="token punctuation">,</span>v1<span class="token punctuation">,</span>v2<span class="token punctuation">)</span>
gl<span class="token punctuation">.</span><span class="token function">vertexAttrib4f</span><span class="token punctuation">(</span>location<span class="token punctuation">,</span>v0<span class="token punctuation">,</span>v1<span class="token punctuation">,</span>v2<span class="token punctuation">,</span>v3<span class="token punctuation">)</span>
</code></pre></div><p>它们都可以改变attribute 变量的前n 个值。</p> <p>比如 vertexAttrib1f() 方法自定一个矢量对象的v0值，v1、v2 则默认为0.0，v3默认为1.0，其数值类型为float 浮点型。</p> <h3 id="用鼠标控制点的步骤"><a href="#用鼠标控制点的步骤" class="header-anchor">#</a> 用鼠标控制点的步骤</h3> <ul><li>获取鼠标在canvas画布中的css位置</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>    canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> clientX<span class="token punctuation">,</span> clientY<span class="token punctuation">}</span> <span class="token operator">=</span> event
        <span class="token keyword">const</span> <span class="token punctuation">{</span> left<span class="token punctuation">,</span> top<span class="token punctuation">}</span> <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> <span class="token punctuation">[</span>cssX<span class="token punctuation">,</span> cssY<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>clientX <span class="token operator">-</span> left<span class="token punctuation">,</span> clientY <span class="token operator">-</span> top<span class="token punctuation">]</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>clientX<span class="token punctuation">,</span>clientY<span class="token punctuation">,</span>left<span class="token punctuation">,</span>top<span class="token punctuation">,</span>cssX<span class="token punctuation">,</span> cssY<span class="token punctuation">)</span>
        <span class="token keyword">const</span> <span class="token punctuation">[</span>halfWidth<span class="token punctuation">,</span> halfHeight<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>canvas<span class="token punctuation">.</span>width<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">]</span>
        <span class="token keyword">const</span> <span class="token punctuation">[</span>xBaseCenter<span class="token punctuation">,</span> yBaseCenter<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>cssX <span class="token operator">-</span> halfWidth<span class="token punctuation">,</span> cssY <span class="token operator">-</span> halfHeight<span class="token punctuation">]</span>
        <span class="token keyword">const</span> yBaseCenterTop <span class="token operator">=</span> <span class="token operator">-</span>yBaseCenter
        <span class="token keyword">const</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span>y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>xBaseCenter<span class="token operator">/</span>halfWidth<span class="token punctuation">,</span>yBaseCenterTop<span class="token operator">/</span>halfHeight<span class="token punctuation">]</span>
        gl<span class="token punctuation">.</span><span class="token function">vertexAttrib2f</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//清空缓冲区</span>
        gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//绘制</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span> 

</code></pre></div><p>当设置body的padiing和margin都是0的时候，canvas设置的宽和高又正好是浏览器的宽高，这时clientX就和cssX相等</p> <img src="/images/webgl2.png" width="500"> <p>已知：向量a(clientX,clientY)，向量c(left,top)</p> <p>求：向量c</p> <p>解：</p> <p>由向量的减法得：向量a减向量c，等于以向量c 的终点为起点，以向量a的终点为终点的向量c</p> <p>所以：向量c=a-c=(clientX-left,clientY-top)</p> <p>将向量c 视之为坐标点c，那点c 就是鼠标在canvas 画布中的css 位。</p> <p>因为html 坐标系中的坐标原点和轴向与canvas 2d是一致的，所以在我们没有用css 改变画布大小，也没有对其坐标系做变换的情况下，鼠标点在canvas 画布中的css 位就是鼠标点在canvas 2d坐标系中的位置</p> <h2 id="理解同步绘图原理"><a href="#理解同步绘图原理" class="header-anchor">#</a> 理解同步绘图原理</h2> <p>首先绘制两个点，然后1秒钟之后绘制另外一个点
正常逻辑应该是这样的</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> a_Position<span class="token operator">=</span>gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span><span class="token string">'a_Position'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//绘制第一个点</span>
gl<span class="token punctuation">.</span><span class="token function">vertexAttrib2f</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span><span class="token number">0.1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//绘制第二个点</span>
gl<span class="token punctuation">.</span><span class="token function">vertexAttrib2f</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
<span class="token comment">//1秒钟绘制第三个点</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttrib2f</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>

</code></pre></div><p>结果是这样的:</p> <p><img src="/images/webgl3.gif" alt="3"></p> <p>原因是每次绘图的时候都是同步的，也就是拿当前准备的颜色缓冲区绘制</p> <p>正确的写法应该是前两个点的存起来，然后第三个点的时候3个一起绘制</p> <div class="language-js extra-class"><pre class="language-js"><code>
  <span class="token keyword">const</span> a_Position<span class="token operator">=</span>gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span><span class="token string">'a_Position'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 指定将要用来清理绘图区的颜色</span>
  gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//清理绘图区</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> g_points <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span><span class="token literal-property property">y</span><span class="token operator">:</span><span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">,</span><span class="token literal-property property">y</span><span class="token operator">:</span><span class="token number">0</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    g_points<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">x</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token literal-property property">y</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//每次绘图之前斗艳清理颜色缓冲区</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    g_points<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>x<span class="token punctuation">,</span>y<span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      gl<span class="token punctuation">.</span><span class="token function">vertexAttrib2f</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
      gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>注意错误：</p> <img src="/images/review02.png" width="400"> <h2 id="鼠标绘制多点"><a href="#鼠标绘制多点" class="header-anchor">#</a> 鼠标绘制多点</h2> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token keyword">let</span> g_points <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> clientX<span class="token punctuation">,</span> clientY<span class="token punctuation">}</span> <span class="token operator">=</span> event
        <span class="token keyword">const</span> <span class="token punctuation">{</span> left<span class="token punctuation">,</span> top<span class="token punctuation">}</span> <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> <span class="token punctuation">[</span>cssX<span class="token punctuation">,</span> cssY<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>clientX <span class="token operator">-</span> left<span class="token punctuation">,</span> clientY <span class="token operator">-</span> top<span class="token punctuation">]</span>
        <span class="token keyword">const</span> <span class="token punctuation">[</span>halfWidth<span class="token punctuation">,</span> halfHeight<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>canvas<span class="token punctuation">.</span>width<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">]</span>
        <span class="token keyword">const</span> <span class="token punctuation">[</span>xBaseCenter<span class="token punctuation">,</span> yBaseCenter<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>cssX <span class="token operator">-</span> halfWidth<span class="token punctuation">,</span> cssY <span class="token operator">-</span> halfHeight<span class="token punctuation">]</span>
        <span class="token keyword">const</span> yBaseCenterTop <span class="token operator">=</span> <span class="token operator">-</span>yBaseCenter
        <span class="token keyword">const</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span>y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>xBaseCenter<span class="token operator">/</span>halfWidth<span class="token punctuation">,</span>yBaseCenterTop<span class="token operator">/</span>halfHeight<span class="token punctuation">]</span>
        g_points<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">x</span><span class="token operator">:</span> x<span class="token punctuation">,</span>
            <span class="token literal-property property">y</span><span class="token operator">:</span> y
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//每次绘图之前斗艳清理颜色缓冲区</span>
        gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        g_points<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>x<span class="token punctuation">,</span>y<span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            gl<span class="token punctuation">.</span><span class="token function">vertexAttrib2f</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
            gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>gl.drawArrays(gl.POINTS, 0, 1) 方法和canvas 2d 里的ctx.draw() 方法是不一样的，ctx.draw() 真的像画画一样，一层一层的覆盖图像。</p> <p>gl.drawArrays() 方法只会同步绘图，走完了js 主线程后，再次绘图时，就会从头再来。也就说，异步执行的drawArrays() 方法会把画布上的图像都刷掉.</p> <h2 id="改变顶点尺寸"><a href="#改变顶点尺寸" class="header-anchor">#</a> 改变顶点尺寸</h2> <p>只要在定义一个变量，动态改变z值即可</p> <p>uniform变量是用来声明非顶点的数据的</p> <h2 id="控制顶点颜色"><a href="#控制顶点颜色" class="header-anchor">#</a> 控制顶点颜色</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">&quot;fragmentShader&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;x-shader/x-fragment&quot;</span><span class="token operator">&gt;</span>
    precision mediump float<span class="token punctuation">;</span>
    uniform vec4 u_FragColor<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        gl_FragColor<span class="token operator">=</span>u_FragColor<span class="token comment">//同样把颜色变量暴露出去</span>
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">&quot;module&quot;</span><span class="token operator">&gt;</span>
    <span class="token keyword">import</span> <span class="token punctuation">{</span>initShaders<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../jsm/Utils.js'</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span>width<span class="token operator">=</span>window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span>height<span class="token operator">=</span>window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
    <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'webgl'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'vertexShader'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
    <span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'fragmentShader'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
    <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> a_Position<span class="token operator">=</span>gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span><span class="token string">'a_Position'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> a_PointSize<span class="token operator">=</span>gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span><span class="token string">'a_PointSize'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> u_FragColor<span class="token operator">=</span>gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span><span class="token string">'u_FragColor'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//拿到颜色变量</span>
    gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> arr<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span>clientX<span class="token punctuation">,</span>clientY<span class="token punctuation">}</span><span class="token operator">=</span>event<span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span>left<span class="token punctuation">,</span>top<span class="token punctuation">,</span>width<span class="token punctuation">,</span>height<span class="token punctuation">}</span><span class="token operator">=</span>canvas<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token punctuation">[</span>cssX<span class="token punctuation">,</span>cssY<span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">[</span>
            clientX<span class="token operator">-</span>left<span class="token punctuation">,</span>
            clientY<span class="token operator">-</span>top
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token punctuation">[</span>halfWidth<span class="token punctuation">,</span>halfHeight<span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">[</span>width<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span>height<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token punctuation">[</span>xBaseCenter<span class="token punctuation">,</span>yBaseCenter<span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">[</span>cssX<span class="token operator">-</span>halfWidth<span class="token punctuation">,</span>cssY<span class="token operator">-</span>halfHeight<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> yBaseCenterTop<span class="token operator">=</span><span class="token operator">-</span>yBaseCenter<span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span>y<span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">[</span>xBaseCenter<span class="token operator">/</span>halfWidth<span class="token punctuation">,</span>yBaseCenterTop<span class="token operator">/</span>halfHeight<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> color<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
            Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token number">1.0</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">//随机的颜色值</span>
        arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span><span class="token literal-property property">z</span><span class="token operator">:</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">50</span><span class="token punctuation">,</span>color<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        arr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>z<span class="token punctuation">,</span>color<span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            gl<span class="token punctuation">.</span><span class="token function">vertexAttrib2f</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//渲染内置</span>
            gl<span class="token punctuation">.</span><span class="token function">vertexAttrib1f</span><span class="token punctuation">(</span>a_PointSize<span class="token punctuation">,</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//渲染大小</span>
            gl<span class="token punctuation">.</span><span class="token function">uniform4fv</span><span class="token punctuation">(</span>u_FragColor<span class="token punctuation">,</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//渲染颜色</span>
            gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p>这样就画出一个随机改变颜色的点了，而且大小不一样</p> <img src="/images/webgl4.png" width="500"> <h2 id="uniform4fv-方法"><a href="#uniform4fv-方法" class="header-anchor">#</a> uniform4fv()方法</h2> <p>在改变uniform 变量的时候，既可以用uniform4f() 方法一个个的写参数，也可以用uniform4fv() 方法传递类型数组。</p> <ul><li>uniform4f 中，4 是有4个数据，f 是float 浮点类型，在我们上面的例子里就是r、g、b、a 这四个颜色数据。</li> <li>uniform4fv 中，4f 的意思和上面一样，v 是vector 矢量的意思，这在数学里就是向量的意思。由之前的4f 可知，这个向量由4个浮点类型的分量构成。</li></ul> <p>在修改uniform变量的时候，这两种写法是一样的：</p> <div class="language-js extra-class"><pre class="language-js"><code>gl<span class="token punctuation">.</span><span class="token function">uniform4f</span><span class="token punctuation">(</span>u_FragColor<span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//等同于</span>
<span class="token keyword">const</span> color<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">uniform4fv</span><span class="token punctuation">(</span>u_FragColor<span class="token punctuation">,</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>uniform4f() 和uniform4fv() 也有着自己的同族方法，其中的4 可以变成1|2|3。</p> <p>uniform4fv() 方法的第二个参数必须是Float32Array 数组，不要使用普通的Array 对象。</p> <p>Float32Array 是一种32 位的浮点型数组，它在浏览器中的运行效率要比普通的Array 高很多。</p> <h2 id="绘制一个圆形的顶点"><a href="#绘制一个圆形的顶点" class="header-anchor">#</a> 绘制一个圆形的顶点</h2> <p>星星的形状是圆形的，所以，我们需要绘制一个圆形的顶点。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    precision mediump float<span class="token punctuation">;</span>
    uniform vec4 u_FragColor<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        float dist <span class="token operator">=</span> <span class="token function">distance</span><span class="token punctuation">(</span>gl_PointCoord<span class="token punctuation">,</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>dist <span class="token operator">&lt;</span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            gl_FragColor <span class="token operator">=</span> u_FragColor<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            discard<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>distance(p1,p2) 计算两个点位的距离</li> <li>gl_PointCoord 片元在一个点中的位置，此位置是被归一化的</li> <li>discard 丢弃，即不会一个片元进行渲染</li></ul> <p>着色器语法参考地址：&lt;https://www.khronos.org/registry/OpenGL-Refpages/gl4/</p> <h2 id="绘制随机透明度的点"><a href="#绘制随机透明度的点" class="header-anchor">#</a> 绘制随机透明度的点</h2> <p>首先我们可以先给canvas 一个星空背景</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">#canvas</span> <span class="token punctuation">{</span>
    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span><span class="token string url">&quot;./images/sky.jpg&quot;</span><span class="token punctuation">)</span></span><span class="token punctuation">;</span>
    <span class="token property">background-size</span><span class="token punctuation">:</span> cover<span class="token punctuation">;</span>
    <span class="token property">background-position</span><span class="token punctuation">:</span> right bottom<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>刷底色的时候给一个透明的底色，这样才能看见canvas的css背景</p> <div class="language-js extra-class"><pre class="language-js"><code>gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>接下来图形的透明度作为变量：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.87</span><span class="token punctuation">,</span> <span class="token number">0.91</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> a<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">uniform4fv</span><span class="token punctuation">(</span>u_FragColor<span class="token punctuation">,</span> arr<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>开启片元的颜色合成功能</p> <div class="language-js extra-class"><pre class="language-js"><code>gl<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">BLEND</span><span class="token punctuation">)</span>
</code></pre></div><p>设置片元的合成方式</p> <p>blendFunc 会让颜色和屏幕的颜色混合在一起</p> <div class="language-js extra-class"><pre class="language-js"><code>gl<span class="token punctuation">.</span><span class="token function">blendFunc</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">SRC_ALPHA</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">ONE_MINUS_SRC_ALPHA</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="星星眨眼睛-其实就是给定几个关键帧-然后根据时间变化让透明度线性变化"><a href="#星星眨眼睛-其实就是给定几个关键帧-然后根据时间变化让透明度线性变化" class="header-anchor">#</a> 星星眨眼睛 其实就是给定几个关键帧，然后根据时间变化让透明度线性变化</h2> <h3 id="抽象一个合成对象-添加一个星星-就添加一条轨道-更新结合的时候-每个轨道都要更新"><a href="#抽象一个合成对象-添加一个星星-就添加一条轨道-更新结合的时候-每个轨道都要更新" class="header-anchor">#</a> 抽象一个合成对象，添加一个星星，就添加一条轨道，更新结合的时候，每个轨道都要更新</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Compose</span><span class="token punctuation">{</span>
    
<span class="token punctuation">}</span>
</code></pre></div><h3 id="抽象一个轨道类"><a href="#抽象一个轨道类" class="header-anchor">#</a> 抽象一个轨道类</h3></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/m_microservices/konga/kongabase.html" class="prev">
        konga基础
      </a></span> <span class="next"><a href="/m_microservices/webGL/graph.html">
        绘制图形
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/m_microservices/assets/js/app.acc81fd3.js" defer></script><script src="/m_microservices/assets/js/2.5d075586.js" defer></script><script src="/m_microservices/assets/js/17.b6232007.js" defer></script>
  </body>
</html>
